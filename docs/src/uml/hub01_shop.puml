@startuml Hub01 Shop

' Colors
!define USER_COLOR #E1F5FE
!define PROJECT_COLOR #E8F5E9
!define VERSION_COLOR #F3E5F5
!define QUOTA_COLOR #FFFDE7
!define SYSTEM_COLOR #F5F5F5

entity "users" USER_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(25)
  *email : varchar(255)
  email_verified_at : timestamp
  unverified_deletion_warning_sent_at : timestamp
  *password : varchar(255)
  bio : varchar(125)
  *role : enum(user, admin)
  avatar : varchar(255)
  remember_token : varchar(100)
  deactivated_at : timestamp
  timestamps : timestamps
}

entity "password_reset_tokens" USER_COLOR {
  *email : varchar(255) <<PK>>
  ---
  *token : varchar(255)
  created_at : timestamp
}

entity "pending_email_changes" USER_COLOR {
  *id : bigint <<PK>>
  ---
  *user_id : bigint <<FK>>
  *old_email : varchar(255)
  *new_email : varchar(255)
  *authorization_token : varchar(255)
  verification_token : varchar(255)
  *status : enum(pending_authorization, pending_verification, completed)
  *authorization_expires_at : timestamp
  verification_expires_at : timestamp
  authorized_at : timestamp
  verified_at : timestamp
  timestamps : timestamps
}

entity "pending_password_changes" USER_COLOR {
  *id : bigint <<PK>>
  ---
  *user_id : bigint <<FK>>
  *hashed_password : varchar(255)
  *verification_token : varchar(255)
  *status : enum(pending_verification, completed)
  *expires_at : timestamp
  verified_at : timestamp
  timestamps : timestamps
}

entity "sessions" SYSTEM_COLOR {
  *id : varchar(255) <<PK>>
  ---
  user_id : bigint <<FK>>
  ip_address : varchar(45)
  user_agent : text
  *payload : longtext
  *last_activity : int
}

entity "project" PROJECT_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(255)
  *slug : varchar(255)
  *summary : text
  *description : text
  logo_path : varchar(255)
  website : varchar(255)
  issues : varchar(255)
  source : varchar(255)
  *status : enum(active, inactive)
  *approval_status : enum(draft, pending, approved, rejected)
  rejection_reason : text
  submitted_at : timestamp
  reviewed_at : timestamp
  reviewed_by : bigint <<FK>>
  deactivated_at : timestamp
  *project_type_id : bigint <<FK>>
  deleted_at : timestamp
  timestamps : timestamps
}

entity "project_type" PROJECT_COLOR {
  *id : bigint <<PK>>
  ---
  *value : varchar(255)
  *display_name : varchar(255)
  *icon : varchar(255)
  timestamps : timestamps
}

entity "membership" PROJECT_COLOR {
  *id : bigint <<PK>>
  ---
  *role : varchar(255)
  *primary : tinyint(1)
  *status : enum(active, pending, rejected)
  invited_by : bigint <<FK>>
  *user_id : bigint <<FK>>
  *project_id : bigint <<FK>>
  timestamps : timestamps
}


entity "project_tag_group" PROJECT_COLOR {
*id : bigint <<PK>>
---
*name : varchar(255)
timestamps : timestamps
}

entity "project_tag" PROJECT_COLOR {
*id : bigint <<PK>>
---
*name : varchar(255)
*icon : varchar(255)
project_tag_group_id : bigint <<FK>>
timestamps : timestamps
}

entity "project_version" VERSION_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(255)
  *version : varchar(255)
  changelog : text
  *release_type : enum(alpha, beta, rc, release)
  *release_date : date
  *downloads : int(10)
  *project_id : bigint <<FK>>
  timestamps : timestamps
}


entity "project_version_tag_group" VERSION_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(255)
  timestamps : timestamps
}

entity "project_version_tag" VERSION_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(255)
  *icon : varchar(255)
  project_version_tag_group_id : bigint <<FK>>
  timestamps : timestamps
}

entity "project_version_dependency" VERSION_COLOR {
  *id : bigint <<PK>>
  ---
  *project_version_id : bigint <<FK>>
  dependency_project_version_id : bigint <<FK>>
  dependency_project_id : bigint <<FK>>
  *dependency_type : enum(required, optional, embedded)
  dependency_name : varchar(255)
  dependency_version : varchar(255)
  timestamps : timestamps
}

entity "project_file" VERSION_COLOR {
  *id : bigint <<PK>>
  ---
  *name : varchar(255)
  *path : varchar(255)
  *size : int(10)
  *project_version_id : bigint <<FK>>
  timestamps : timestamps
}


entity "project_quota" QUOTA_COLOR {
  *id : bigint <<PK>>
  ---
  *project_id : bigint <<FK>>
  project_storage_max : bigint
  versions_per_day_max : int
  version_size_max : bigint
  files_per_version_max : int
  file_size_max : bigint
  timestamps : timestamps
}

entity "project_type_quota" QUOTA_COLOR {
  *id : bigint <<PK>>
  ---
  *project_type_id : bigint <<FK>>
  project_storage_max : bigint
  versions_per_day_max : int
  version_size_max : bigint
  files_per_version_max : int
  file_size_max : bigint
  timestamps : timestamps
}

entity "user_quota" QUOTA_COLOR {
  *id : bigint <<PK>>
  ---
  *user_id : bigint <<FK>>
  total_storage_max : bigint
  timestamps : timestamps
}


entity "notifications" USER_COLOR {
  *id : uuid <<PK>>
  ---
  *type : varchar(255)
  *notifiable_type : varchar(255)
  *notifiable_id : bigint
  *data : text
  read_at : timestamp
  created_at : timestamp
  updated_at : timestamp
}

entity "abuse_reports" SYSTEM_COLOR {
  *id : bigint <<PK>>
  ---
  *reason : text
  *reportable_id : bigint
  *reportable_type : varchar(255)
  *reporter_id : bigint <<FK>>
  *status : enum(pending, resolved)
  created_at : timestamp
  updated_at : timestamp
  deleted_at : timestamp
}

users ||--o{ sessions
users ||--o{ membership : "invited user"
users ||--o{ pending_email_changes
users ||--o{ pending_password_changes
users ||--o{ project : "reviewed_by"
users ||--o{ notifications : "notifiable"
users ||--o{ abuse_reports : "reporter"
users |o--o{ abuse_reports : "reportable"
users ||--o| user_quota

membership }o--|| project
project ||--o{ project_version
project ||--o| project_quota
project }|--|| project_type

membership }o--o| users : "invited_by"

project_version ||--o{ project_file
project_version ||-o{ project_version_dependency : "dependent version"
project_version_dependency }o-o| project_version : "dependency version"
project |o--o{ project_version_dependency : "dependency project"

project_tag_group ||--o{ project_tag
project_version_tag_group ||--o{ project_version_tag

project_type ||--o| project_type_quota
project_type }o--o{ project_tag_group : "allowed tag groups"
project_type }o--o{ project_tag : "allowed tags"
project_type }o--o{ project_version_tag_group : "allowed version tag groups"
project_type }o--o{ project_version_tag : "allowed version tags"

abuse_reports }o--o| project : "reportable"
abuse_reports }o--o| project_version : "reportable"

project }o--o{ project_tag
project_version }o--o{ project_version_tag

@enduml
